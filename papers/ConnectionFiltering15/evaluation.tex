\begin{table*}[t]
\vspace{-0.15in}
\caption{Comparison with the Manually Established Results.}
\label{tbl:eval}
\centering
\tabcolsep=2.0pt
\resizebox{0.85\textwidth}{!}{%
\begin{tabular}{|l|C{2.5cm}|C{2.5cm}|C{2.5cm}|C{2.5cm}|C{1.4cm}|}
\hline
\multirow{3}{*}{\textbf{Applications}} & \multicolumn{2}{c|}{\textbf{Correctly detected non-essential}} & \multicolumn{2}{c|}{\textbf{Correctly detected non-essential}} & \multirow{3}{1.4cm}{\textbf{Execution time}} \\
                                       & \multicolumn{2}{c|}{}                                          & \multicolumn{2}{c|}{\textbf{(counting ads as non-essential)}}  &            \\
\cline{2-5}
                                & Precision         & Recall            & Precision         & Recall            &       \\
\hline
%--------------------------------------------------------------------
air.com.sgn.cookiejam.gp        & 1/1 (100.0\%)  & 1/3 (33.3\%)   & 1/1 (100.0\%)  & 1/3 (33.3\%)   & 1min 50s \\
com.crimsonpine.stayinline      & 13/18 (72.2\%)  & 13/13 (100.0\%)  & 18/18 (100.0\%)  & 18/18 (100.0\%) & 1min 52s \\
com.grillgames.guitarrockhero   & 17/22 (77.3\%)  & 17/30 (56.7\%)  & 22/22 (100.0\%)  & 22/35 (62.9\%) & 2min 54s \\
com.king.candycrushsaga         & 3/3 (100.0\%)  & 3/3 (100.0\%)  & 3/3 (100.0\%)  & 3/3 (100.0\%)  & 1min 53s \\
com.pandora.android             & 4/4 (100.0\%)  & 4/9 (44.4\%)   & 4/4 (100.0\%)  & 4/9 (44.4\%)  & 2min 13s \\
com.spotify.music               & 4/7 (57.1\%)   & 4/21 (19.0\%)  & 4/7 (57.1\%)   & 4/21 (19.0\%)  & 2min 18s \\
com.twitter.android             & 4/4 (100.0\%)  & 4/6 (66.7\%)   & 4/4 (100.0\%)  & 4/6 (66.7\%)  & 2min 33s \\
com.walmart.android             & 3/5 (60.0\%)   & 3/5 (60.0\%)   & 3/5 (60.0\%)   & 3/5 (60.0\%)  & 2min 17s \\
net.zedge.android               & 15/18 (83.3\%)  & 15/16 (93.8\%)  & 18/18 (100.0\%)  & 18/19 (94.7\%) & 2min 31s \\
\hline
%--------------------------------------------------------------------
Totals (average)                & 64/82 (83.3\%)   & 64/106 (63.8\%)  & 77/82 (90.8\%)   & 77/119 (64.6\%) & 2min 15.7s \\
\hline
%--------------------------------------------------------------------
\end{tabular}
}% resizebox
\end{table*}

\section{Experiments}
\label{sec:evaluation}
To establish the quality of our static analysis algorithm, we evaluate it on the ``truth set'' established during our in-depth case study (see Section~\ref{sec:study}). We then use it to gather information and report on non-essential communication in the 500 top-popular Android applications from Google Play.

\subsection{Evaluation of the Static Analysis}
For our evaluation, we limit the set of results reported by the static analysis to those that were, in fact,
 triggered during our dynamic study (see Table~\ref{tbl:applications} in Section~\ref{sec:study}): these are the connection statements for which we have reliable information to compare against. 
We assess the results, for each application individually and averaged for all applications, using the metrics below. The results are summarized in Table~\ref{tbl:eval}.

\begin{enumerate}[leftmargin=0.5cm]\setlength{\itemsep}{-0.05in}
\item
\emph{Expected}: the size of the predetermined expected result, i.e., the number of connections listed as non-essential in Table~\ref{tbl:applications}.
\item
\emph{Reported}: the number of connections deemed as non-essential by the static analysis. 
\item
 \emph{Correct}: the number of non-essential connections correctly identified by the static analysis, i.e., that were deemed as non-essential in the dynamic study as well.
% reported by the technique.\\
\item
\emph{Precision}: the fraction of relevant results among those reported,
% by the technique,
 calculated as \emph{$\frac{\text{Correct}}{\text{Reported}}$}. 
\item
\emph{Recall}: the fraction of relevant results among those expected, calculated as
\emph{$\frac{\text{Correct}}{\text{Expected}}$}.
%\item
%\emph{F-measure}: a harmonized measure combining precision and recall, whose
%value is high if both precision and recall are high, calculated as \emph{$\frac{2 \times \text{Precision} \times \text{Recall}}{\text{Precision} + \text{Recall}}$}. This measure is usually used to evaluate the accuracy of a technique as
%it does not allow trading-off precision for recall and vise versa.
\item \emph{Execution time}: the execution time of the analysis, measured by averaging results of
three runs on an Intel\textsuperscript{\textregistered} Xeon\textsuperscript{\textregistered} CPU E5-2690 v2 @ 3.00GHz machine running Ubuntu 12.04.5. The machine was configured to use at most 16GB of heap and performs no parallelization for a single application, i.e., each application uses one core only.
\end{enumerate}
  
As can be seen in the second and the third columns of Table~\ref{tbl:eval}, the overall averaged precision of our analysis is 83.3\%. 
The analysis correctly identified 64 non-essential connections out of the total 82 reported. 
18 connections were mis-classified, out of which 16 correspond to \emph{optional} application behaviors, i.e.,
when connection failures are indeed ignored and the applications proceed without the missing information. The 
remaining two cases correspond to a \emph{stateful} communication within the application. 
The details of each of these cases are given below: 

\begin{itemize}[leftmargin=0.5cm]\setlength{\itemsep}{-0.05in}
\item 13 connections are used for presenting \emph{optional} advertisement content: 
3 in the \emph{net.zedge.android} application, and 
5 in \\
\emph{com.crimsonpine.stayinline} and \emph{com.grillgames.guitarrockhero} each.
\item 3 connections correspond to 
\emph{optional} application behaviors: 2 in the \emph{com.walmart.android} application, responsible for providing location-aware search, and 1 in the \emph{com.spotify.music} application, responsible for enhancing the presented album with images.
\item 2 connections, both in \emph{com.spotify.music}, correspond to \emph{stateful} communication within the application. 
Blocking each of these connections, individually, harms the application's search capabilities.
\end{itemize}

Considering the advertisement information as non-essential gives an overall average precision of 90.8\%, as shown in column 4 of Table~\ref{tbl:eval}. 
That is, depending on the user's perspective, 
between 83\% and 90\% of the cases identified as non-essential by the static analysis indeed do not affect the behavior of the applications. 

While designed to be conservative, our analysis is able to correctly identify 64 out of 106 connection statements deemed non-essential in the empirical study, resulting in the overall recall of 63.8\% (column 3 in Table~\ref{tbl:eval}). Considering advertisement non-essential results in a slight increase in recall, to 64.6\% (column 4 in Table~\ref{tbl:eval}).
The technique correctly identifies the majority of non-essential connections.

Finally, the last column of table Table~\ref{tbl:eval} shows that our analysis is highly efficient -- it runs in a matter of minutes even on large applications. 

\conclusion{To answer RQ3, we conclude that a static analysis can be applied for an accurate detection of non-essential connections. Our highly scalable technique features up to 90\% precision and 64\% recall, respectively.}



%\begin{table}[t]
%\renewcommand*{\arraystretch}{1.3}
%\caption{Top 20 Non-Essential Communication Callers.}
%\label{tbl:callers}
%\centering
%\tabcolsep=1.5pt
%\resizebox{\columnwidth}{!}{%
%\begin{tabular}{|r|P{3.2cm}|P{3.5cm}|C{1.8cm}|C{1.8cm}|}
%\hline
%%--------------------------------------------------------------------
%  &                 & Description                       & Used in \# (\%) of Apps   & (\%) from Total Non-Essential Calls in a App (Avg.)  \\
%\hline
%%--------------------------------------------------------------------
% 1. & com.google.android.gms       &  Google mobile services        & 403 (80.6\%) & 91.0\% \\
% 2. & com.facebook          &  Facebook services         & 190 (38.0\%) &  2.4\% \\
% 3. & com.android.\newline{}vending.billing   &  Google in-app billing        & 139 (27.8\%) &  1.6\% \\
% 4. & com.chartboost.sdk        &  Gaming services          & 116 (23.2\%) &  0.8\% \\
% 5. & com.flurry.sdk         &  Advertising, monetization and analytics services & 79 (15.8\%) &  3.9\% \\
% 6. & com.millennialmedia.\newline{}android   &  Advertising, monetization and analytics services & 76 (15.2\%) &  1.9\% \\
% 7. & com.mopub.mobileads        &  Advertising, monetization and analytics services & 70 (14.0\%) &  1.1\% \\
% 8. & com.tapjoy          &  Advertising, monetization and analytics services & 47  (9.4\%) &  3.7\% \\
% 9. & com.bda.controller        &  PhoneGap game controller       & 23  (4.6\%) &  2.4\% \\
%10. & com.unity3d.\newline{}plugin.downloader   &  Gaming Services          & 21  (4.2\%) & 20.3\% \\
%%11. & com.outfit7.\newline{}talkingfriends.offers  &  Components of Outfit7 Android developers   & 16  (3.2\%) &  2.5\% \\
%%12. & com.google.android.\newline{}youtube.player  &  Google YouTube API         & 11  (2.2\%) & 16.5\% \\
%%13. & com.cleanmaster         &  Phone Booster and Antivirus app      & 8  (1.6\%) & 24.5\% \\
%%14. & com.ijinshan.kbackup        &  Cloud backup and restore app      & 3  (0.6\%) & 26.5\% \\
%%15. & cn.wps.moffice         &  Office app           & 1  (0.2\%) & 77.1\% \\
%\hline
%%--------------------------------------------------------------------
%\end{tabular}
%}% resizebox
%\end{table}

\begin{table}[t]
\renewcommand*{\arraystretch}{1.3}
\vspace{-0.15in}
\caption{Top 20 Non-Essential Communication Callers.}
\label{tbl:callers}
\centering
\tabcolsep=1.5pt
\resizebox{0.9\columnwidth}{!}{%
\begin{tabular}{|r|P{3.2cm}|P{3.5cm}|C{1.8cm}|C{1.8cm}|}
\hline
%--------------------------------------------------------------------
    &                         & Description                           & Used in \# (\%) of Apps  \\
\hline
%--------------------------------------------------------------------
 1. & com.google.android.gms            &  Google mobile services             & 403 (80.6\%)  \\
 2. & com.facebook                &  Facebook services               & 190 (38.0\%)  \\
 3. & com.android.\newline{}vending.billing     &  Google in-app billing             & 139 (27.8\%)  \\
 4. & com.chartboost.sdk             &  Gaming services                & 116 (23.2\%)  \\
 5. & com.flurry.sdk               &  Advertising, monetization and analytics services & 79 (15.8\%)  \\
 6. & com.millennialmedia.\newline{}android     &  Advertising, monetization and analytics services & 76 (15.2\%)  \\
 7. & com.mopub.mobileads             &  Advertising, monetization and analytics services & 70 (14.0\%)  \\
 8. & com.tapjoy                 &  Advertising, monetization and analytics services & 47  (9.4\%)  \\
 9. & com.bda.controller             &  PhoneGap game controller            & 23  (4.6\%)  \\
10. & com.unity3d.\newline{}plugin.downloader    &  Gaming Services                & 21  (4.2\%)  \\
%11. & com.outfit7.\newline{}talkingfriends.offers  &  Components of Outfit7 Android developers     & 16  (3.2\%)  \\
%12. & com.google.android.\newline{}youtube.player  &  Google YouTube API               & 11  (2.2\%)  \\
%13. & com.cleanmaster               &  Phone Booster and Antivirus app         & 8  (1.6\%)  \\
%14. & com.ijinshan.kbackup             &  Cloud backup and restore app          & 3  (0.6\%)  \\
%15. & cn.wps.moffice               &  Office app                  & 1  (0.2\%)  \\
\hline
%--------------------------------------------------------------------
\end{tabular}
}% resizebox
\end{table}

\subsection{Non-Essential Communication In the Wild}

We apply our technique on the 500 most popular Android application
downloaded from the Google Play store in January 2015.  Our goal is to
investigate how often non-essential communication occurs in real-life
applications and what are its most common destinations.

%\begin{table}[t]
%\caption{Analysis of the 500 Top-Popular Applications from Google Play.}
%\label{tbl:googlePlayApps}
%\centering
%\tabcolsep=1.5pt
%%\resizebox{\columnwidth}{!}{%
%\begin{tabular}{|l|C{2.8cm}|C{1.9cm}|}
%\hline
%%--------------------------------------------------------------------
%                    & Non-Essential     & Total          \\ % Exec. time
%\hline
%%--------------------------------------------------------------------
%Total (500 apps)    & 283,159 (84.2\%)  &  336,203       \\ % 23h 54min 1s
%Avg. per app        &   566.3           &  672.4         \\ %   2min 52s
%\hline
%%--------------------------------------------------------------------
%\end{tabular}
%%}% resizebox
%\end{table}

Our analysis reveals that 84.2\% of all connections encoded in these application can be considered non-essential (283,159 connection out of 336,203 in total).
These results are consistent with the observation of our empirical study described in Section~\ref{sec:study}.
%, showing that a large percent of connections
%made by applications can be considered non-essential.  In fact, even
%with our conservative analysis, 84\% of connections fall into that
%category.
%In Table~\ref{tbl:googlePlayApps}, we report on the number of
%non-essential connections found in these applications in total, and
%for an application on average.  These results confirm the observation
%of our empirical study, showing that a large percent of connections
%made by applications can be considered non-essential.  In fact, even
%with our conservative analysis, 84\% of connections fall into that
%category.
Table~\ref{tbl:callers} presents the top 10 packages in which
non-essential connections occur.  As the numbers are aggregated for
500 applications, it is not a surprise that Google Services, as well
as gaming, advertisement and analytics services, are on the top of the
list -- numerous applications use these services, as shown in the last
column of Table~\ref{tbl:callers}.  By manually investigating some of
the most-popular connections in reverse-engineered versions of the
applications, we observed that those connections are designed to be
``best-effort'' only. For example, an application might attempt to
obtain user-specific advertisement information, but continues with
generic advertisement if that attempt fails.  The prevalence of mobile
services and their ``best-effort'' behavior make us believe that it
would be beneficial if these services were designed to allow users to
select the level of support they wish to obtain, instead of relying
merely on connectivity for that purpose.

 
%The last column of the table shows the ratio of non-essential calls 
%made from a package out of the total number of non-essential calls, averaged for all applications that use the corresponding package, e.g., 403 in the case of Google Services. 
%Interestingly, the highest fraction of non-essential calls made by applications falls within this package. 
%There could be two reasons for this finding: first, applications commonly register for various Google services  services without eventually using
%them.


%Dead code comes from libraries. If 
%it is just not used by a specific application, but might be used by another one, so it is good to analaze it in any case


\conclusion{To answer RQ4, we conclude that non-essential communication is very common in real-life applications. 
Most such communication is performed with various mobile services that are designed to be ``best-effort only'', i.e., communication failures do not prevent 
successful application execution. Designing mobile services to allow the user to select the preferred level of support instead of relying merely on connectivity would be a more desirable approach.}


