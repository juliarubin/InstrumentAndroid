\begin{table}[t]
\vspace{-0.15in}
\caption{Comparison with the Manually Established Results.}
\label{tbl:eval}
\centering
\tabcolsep=2.0pt
\resizebox{1.0\columnwidth}{!}{%
\begin{tabular}{|l|C{2.7cm}|C{2.7cm}|C{1.9cm}|}
\hline
\multirow{2}{*}{\textbf{Applications}} & \multicolumn{2}{c|}{\textbf{Correctly detected non-essential}} & \multirow{2}{1.4cm}{\textbf{Execution time}} \\
\cline{2-3}
                                & Precision         & Recall            &    \\
\hline
%--------------------------------------------------------------------
air.com.sgn.cookiejam.gp  & 1/1 (100.0\%)  & 1/2 (50.0\%)  & 2min 11s \\
com.crimsonpine.stayinline  & 2/2 (100.0\%)  & 2/2 (100.0\%)  & 2min 24s \\
com.devuni.flashlight   & 1/2 (50.0\%)  & 1/1 (100.0\%)  & 1min 44s \\
com.emoji.Smart.Keyboard  & 2/2 (100.0\%)  & 2/2 (100.0\%)  & 1min 16s \\
com.grillgames.guitarrockhero & 1/1 (100.0\%)  & 1/14 (7.1\%)  & 6min 14s \\
com.jb.emoji.gokeyboard   & 4/4 (100.0\%)  & 4/7 (57.1\%)  & 3min 22s \\
com.pandora.android    & 4/4 (100.0\%)  & 4/9 (44.4\%)  & 2min 41s \\
com.spotify.music    & 1/1 (100.0\%)  & 1/3 (33.3\%)  & 2min 51s \\
com.twitter.android    & 1/1 (100.0\%)  & 1/3 (33.3\%)  & 3min  3s \\
com.walmart.android    & 3/3 (100.0\%)  & 3/5 (60.0\%)  & 3min  2s \\
net.zedge.android    & 3/4 (75.0\%)  & 3/4 (75.0\%)  & 4min 13s \\
\hline
%--------------------------------------------------------------------
Average       & 23/25 (93.2\%) & 23/52 (60.0\%) & 2min 48s \\
\hline
%--------------------------------------------------------------------
\end{tabular}
}% resizebox
\end{table}

\section{Experiments}
\label{sec:evaluation}
We start by assessing the quality of our static analysis technique. 
We then apply it to gather information about common patterns of non-essential communication in the 500 most popular Android applications on Google Play. 

%To establish the quality of our static analysis technique, we first evaluate its precision and recall on the ``truth set'' established during our in-depth case study (see Section~\ref{sec:study}). 
%We then apply our analysis on 500 top-popular Android applications from Google Play. 
%We select XX of these application for further investigation. In that investigation, we inject failures in all connection statements identified as non-essential by our static analysis, as described in Section~\ref{sec:study}, 
%and they employ humans to check whether these are any observable differences between the original and the modified application, 
%Finally, we use the 

\subsection{Quality of the Static Analysis}
To establish the quality of our technique, we 
first evaluate its accuracy, i.e., precision and recall, on the ``truth set'' established during our in-depth case study (see Section~\ref{sec:study}).
We then do a usability assessment, evaluating the user-experience when running a version of an application in which we disable all connections deemed non-essential, and compare that to the experience running the original copy.  

\subsubsection{Accuracy}
For the accuracy evaluation, we look again at all applications listed in 
Table~\ref{tbl:applications} except facebook and candycrush, as these two applications  did not exhibit any non-essential communication. We limit the set of results reported by the static analysis to those that were, in fact, triggered during our dynamic study: only for these connections we have established the ``ground truth''. 
% (see Table~\ref{tbl:applications} in Section~\ref{sec:study}): these are the connection statements for which we have reliable information to compare against. 
We assess the results, for each application individually and averaged for all applications, using the metrics below. 

\begin{itemize}[leftmargin=0.5cm]%\setlength{\itemsep}{-0.05in}
%\emph{Expected}: the size of the predetermined expected result, i.e., the number of connections listed as non-essential in Table~\ref{tbl:applications}.
%\item
%\emph{Reported}: the number of connections deemed as non-essential by the static analysis. 
%\item
% \emph{Correct}: the number of non-essential connections correctly identified by the static analysis, i.e., those that were deemed as non-essential in the dynamic study as well.
% reported by the technique.\\
\item \emph{Precision}: the fraction of connection statements correctly identified as non-essential among those reported by the technique.
% calculated as \emph{$\frac{\text{Correct}}{\text{Reported}}$}. 
\item \emph{Recall}: the fraction of connection statements correctly identified as non-essential among those expected, i.e., marked as non-essential during the dynamic study. 
%, calculated as
%\emph{$\frac{\text{Correct}}{\text{Expected}}$}.
%\item
%\emph{F-measure}: a harmonized measure combining precision and recall, whose
%value is high if both precision and recall are high, calculated as \emph{$\frac{2 \times \text{Precision} \times \text{Recall}}{\text{Precision} + \text{Recall}}$}. This measure is usually used to evaluate the accuracy of a technique as
%it does not allow trading-off precision for recall and vise versa.
\item \emph{Execution time}: the execution time of the analysis, measured by averaging results of
three runs on an Intel\textsuperscript{\textregistered} Xeon\textsuperscript{\textregistered} CPU E5-2690 v2 @ 3.00GHz machine running Ubuntu 12.04.5. The machine was configured to use at most 16GB of heap and to perform no parallelization for a single application, i.e., each application uses one core only.
\end{itemize}
  
The results of this experiment are summarized in Table~\ref{tbl:eval}.  
The second column of the table shows that the overall averaged precision of our analysis is 93.2\%. 
The analysis correctly identifies all but two non-essential connections. 
The first one, in \emph{com.devuni.flashlight}, is responsible for presenting icons of extensions that can be downloaded from Google Play. The misclassification stems from the fact that GUI updates for these images happen after the success and failure paths unifies, and are thus missed by our search. 

The second misclassified connection, in \emph{net.zedge.android}, is responsible for presenting advertisement material and belongs to the \emph{com.mopub.mobileads} A\&A service library packaged with the application. 
That library relies on asynchronous RPC communication with Google services 
installed on the same device. Our static analysis does not track inter-application communication between various applications and services on the device, hence the false-positive result.   
 
% out of the total 82 reported. 
%18 connections were mis-classified, out of which 16 correspond to \emph{optional} application behaviors, i.e.,
%when connection failures are indeed ignored and the applications proceed without the missing information. The 
%remaining two cases correspond to a \emph{stateful} communication within the application. 
%The details of each of these cases are given below: 

%\begin{itemize}[leftmargin=0.5cm]%\setlength{\itemsep}{-0.05in}
%\item 13 connections are used for presenting \emph{optional} advertisement content: 
%3 in the \emph{net.zedge.android} application, and 
%5 in \\
%\emph{com.crimsonpine.stayinline} and \emph{com.grillgames.guitarrockhero} each.
%\item 3 connections correspond to 
%\emph{optional} application behaviors: 2 in the \emph{com.walmart.android} application, responsible for providing location-aware search, and 1 in the \emph{com.spotify.music} application, responsible for enhancing the presented album with images.
%\item 2 connections, both in \emph{com.spotify.music}, correspond to \emph{stateful} communication within the application. 
%Blocking each of these connections, individually, harms the application's search capabilities.
%\end{itemize}
%
%Considering the advertisement information as non-essential gives an overall average precision of 90.8\%, as shown in column 4 of Table~\ref{tbl:eval}. 
%That is, depending on the user's perspective, 
%between 83\% and 90\% of the cases identified as non-essential by the static analysis indeed do not affect the behavior of the applications. 

While designed to be conservative, our analysis is able to correctly identify 
%64 out of 106 connection
60\% of statements deemed non-essential in the empirical study 
%, resulting in the overall recall of 63.8\% 
(column 3 in Table~\ref{tbl:eval}).  The major reasons for why we do
not achieve higher recall are (1) a conservative, though feasibly
analyzable, definition of {\it processing} related to a connection
call, and (2) conservative call graph construction, specifically
w.r.t. reflection,.  Finally, the analysis is highly efficient and
runs in a matter of minutes even on large applications, as shown in
the last column of table Table~\ref{tbl:eval}.


%Considering advertisement non-essential results in a slight increase in recall, to 64.6\% (column 5 in Table~\ref{tbl:eval}).
%The technique correctly identifies the majority of non-essential connections.

\subsubsection{Usability Assessment}
To check whether our technique is able to provide actionable results, we further select 100 applications that persisted in the list of the 500 most popular free applications on Google Play in November 2014 and May 2015 samples. 
We used two Nexus devices running Android v4.4.4, installing the original version of an applications on one, and a modified version on the other. We produced the modified version by the \emph{blocking transformation} specified in Section~\ref{sec:study} to disable all calls identified as non-essential by the static analysis. 

We recruited two human subjects, both experienced software developers, and paired each with an author of this paper.
Each pair was given one device with the original and one with the modified versions of the applications. We asked them to execute the same application simultaneously on both devices for 10 minutes, and to record all differences during that execution.
We asked the participants to avoid signing in with a Google Plus account or performing in-app purchases from the Google Play store, as these features are not supported in resigned applications, as discussed in Section~\ref{sec:study}.

When analyzing the results of that experiment, we exclude 14 application that were non-operational (either did not run, in both versions, or required payment to continue running);
 17 applications for which asm-based instrumentation failed or the instrumented version did not run due to issues related to the resigning process;
 2 Google Play applications that we could not replace;
5 chat applications;
4 applications that either contained no connection statements or had no non-essential connection statements detected;
and 11 applications for which no non-essential connection statement were triggered during the execution of the application.

\begin{table}[b]
\vspace{-0.15in}
\caption{Results of usability assessment.}
\label{tbl:userstudy}
\centering
\tabcolsep=2.5pt
\resizebox{0.6\columnwidth}{!}{%
\begin{tabular}{|l|C{1.8cm}|}
\hline
Classification & \# (\%) of cases\\
\hline
%--------------------------------------------------------------------
Identical       & 30 (63.8\%) \\
No advertisement     & 9  (19.2\%) \\
Missing some functionality   & 3  (6.4\%) \\
Missing essential functionality  & 5  (10.6\%) \\
\hline
%--------------------------------------------------------------------
\end{tabular}
}% resizebox
\end{table}

Information about the remaining 47 applications is given in Table~\ref{tbl:userstudy}. 
Our participants did not observe any noticeable differences in 30 applications (63.8\%). 
In 9 cases (19.1\%), the advertisement material was missing, similarly to the zedge example described above. For 3 applications (6.4\%), the participants observed absence of features that they considered minor: 2 cases of missing icons, in the flashlight and the talkingben applications, and 1 case were they could not create an account for the antivirus application, but the core functionality of that application was intact. 

Only 5 applications (10.6\%) where missing essential functionality %or seriously broken: 
Battery Saver, Spider-Man and Minion Rush games, Microsoft Office Mobile and PicsArt Photo Studio. We conjecture that the last case might me related to resigning issues, but we could not verify that. 

Overall, these results are very encouraging and demonstrate that, in a vast majority of cases, the results of our static analysis can be directly applied to disable non-essential communication. 

\conclusion{To answer RQ3, we conclude that the static analysis proposed in this paper can be applied for an accurate detection of non-essential connections. The technique is precise, highly scalable and provides actionable output for disabling non-essential communication in mobile applications.}



%\begin{table}[t]
%\renewcommand*{\arraystretch}{1.3}
%\caption{Top 20 Non-Essential Communication Callers.}
%\label{tbl:callers}
%\centering
%\tabcolsep=1.5pt
%\resizebox{\columnwidth}{!}{%
%\begin{tabular}{|r|P{3.2cm}|P{3.5cm}|C{1.8cm}|C{1.8cm}|}
%\hline
%%--------------------------------------------------------------------
%  &                 & Description                       & Used in \# (\%) of Apps   & (\%) from Total Non-Essential Calls in a App (Avg.)  \\
%\hline
%%--------------------------------------------------------------------
% 1. & com.google.android.gms       &  Google mobile services        & 403 (80.6\%) & 91.0\% \\
% 2. & com.facebook          &  Facebook services         & 190 (38.0\%) &  2.4\% \\
% 3. & com.android.\newline{}vending.billing   &  Google in-app billing        & 139 (27.8\%) &  1.6\% \\
% 4. & com.chartboost.sdk        &  Gaming services          & 116 (23.2\%) &  0.8\% \\
% 5. & com.flurry.sdk         &  Advertising, monetization and analytics services & 79 (15.8\%) &  3.9\% \\
% 6. & com.millennialmedia.\newline{}android   &  Advertising, monetization and analytics services & 76 (15.2\%) &  1.9\% \\
% 7. & com.mopub.mobileads        &  Advertising, monetization and analytics services & 70 (14.0\%) &  1.1\% \\
% 8. & com.tapjoy          &  Advertising, monetization and analytics services & 47  (9.4\%) &  3.7\% \\
% 9. & com.bda.controller        &  PhoneGap game controller       & 23  (4.6\%) &  2.4\% \\
%10. & com.unity3d.\newline{}plugin.downloader   &  Gaming Services          & 21  (4.2\%) & 20.3\% \\
%%11. & com.outfit7.\newline{}talkingfriends.offers  &  Components of Outfit7 Android developers   & 16  (3.2\%) &  2.5\% \\
%%12. & com.google.android.\newline{}youtube.player  &  Google YouTube API         & 11  (2.2\%) & 16.5\% \\
%%13. & com.cleanmaster         &  Phone Booster and Antivirus app      & 8  (1.6\%) & 24.5\% \\
%%14. & com.ijinshan.kbackup        &  Cloud backup and restore app      & 3  (0.6\%) & 26.5\% \\
%%15. & cn.wps.moffice         &  Office app           & 1  (0.2\%) & 77.1\% \\
%\hline
%%--------------------------------------------------------------------
%\end{tabular}
%}% resizebox
%\end{table}



\subsection{Non-Essential Communication in the Wild}

We next apply our technique on the 500 most popular Android application
downloaded from the Google Play store. By considering such a large data set, our goal is to
investigate how often non-essential communication occurs and what its most common sources are.

%\begin{table}[t]
%\caption{Analysis of the 500 Top-Popular Applications from Google Play.}
%\label{tbl:googlePlayApps}
%\centering
%\tabcolsep=1.5pt
%%\resizebox{\columnwidth}{!}{%
%\begin{tabular}{|l|C{2.8cm}|C{1.9cm}|}
%\hline
%%--------------------------------------------------------------------
%                    & Non-Essential     & Total          \\ % Exec. time
%\hline
%%--------------------------------------------------------------------
%Total (500 apps)    & 283,159 (84.2\%)  &  336,203       \\ % 23h 54min 1s
%Avg. per app        &   566.3           &  672.4         \\ %   2min 52s
%\hline
%%--------------------------------------------------------------------
%\end{tabular}
%%}% resizebox
%\end{table}

\begin{table}[t]
\renewcommand*{\arraystretch}{1.3}
\vspace{-0.15in}
\caption{Top 10 Non-Essential Communication Callers.}
\label{tbl:callers}
\centering
\tabcolsep=1.5pt
\resizebox{1.0\columnwidth}{!}{%
\begin{tabular}{|c|P{2.6cm}|P{3.6cm}|C{1.9cm}|C{2.4cm}|}
\hline
%--------------------------------------------------------------------
 &
 \textbf{Package} &
 \textbf{Description} &
 \textbf{Used in \#~(\%)~of~Apps} &
 \textbf{Non-essential~calls (\%~of~total~calls)} \\
\hline
1.  & com.google.android    & Google services          & 382 (76.4\%)  & 1913 (49.9\%) \\
2.  & com.gameloft      & Mobile games          & 17 (3.4\%)  & 784 (87.4\%) \\
3.  & com.inmobi      & A\&A services  & 61 (12.2\%)  & 615 (67.6\%) \\
4.  & com.millennialmedia.\newline{}android  & A\&A services  & 78 (15.6\%)  & 447 (58.8\%) \\
5.  & com.mopub.mobileads    & A\&A services  & 72 (14.4\%)  & 320 (56.9\%) \\
6.  & com.tapjoy      & A\&A services  & 49 (9.8\%)  & 277 (43.8\%) \\
7.  & com.facebook      & Facebook services          & 112 (22.4\%)  & 222 (24.3\%) \\
8.  & com.unity3d      & Gaming services          & 77 (15.4\%)  & 203 (41.8\%) \\
9.  & (default)       & Default package of an application      & 23 (4.6\%)  & 178 (48\%) \\
10.  & com.flurry      & A\&A services  & 95 (19\%)   & 175 (35.3\%) \\

\hline
%--------------------------------------------------------------------
\end{tabular}
}% resizebox
\end{table}


Our analysis reveals that 46.2\% of all connections encoded in these application can be considered non-essential (8,539 connection out of 18,480 in total).
These results are consistent with the observation of our empirical study described in Section~\ref{sec:study}.
%, showing that a large percent of connections
%made by applications can be considered non-essential.  In fact, even
%with our conservative analysis, 84\% of connections fall into that
%category.
%In Table~\ref{tbl:googlePlayApps}, we report on the number of
%non-essential connections found in these applications in total, and
%for an application on average.  These results confirm the observation
%of our empirical study, showing that a large percent of connections
%made by applications can be considered non-essential.  In fact, even
%with our conservative analysis, 84\% of connections fall into that
%category.

Table~\ref{tbl:callers} presents the top 10 packages in which
non-essential connections occur.  As the numbers are aggregated for
500 applications, it is no surprise that Google Services, as well
as gaming, advertisement and analytics services, are on top of the
list -- numerous applications use these services, as shown in the one but last
column of Table~\ref{tbl:callers}.
More surprising is the \emph{com.gameloft} package that is part of 17 different mobile applications by the same company. The number of non-essential connection statements these game applications contain is notable. 

The last column of Table~\ref{tbl:userstudy} shows the percentage of non-essential connections out of all connection statements in the corresponding package. This number varies between 24\% and 87\%, confirming, again, our initial observation in Section~\ref{sec:study} that the source of a connection cannot be use to determine its impact on the application behavior. 

%By manually investigating some of
%the most-popular connections in reverse-engineered versions of the
%applications, we observed that those connections are designed to be
%``best-effort'' only. For example, an application might attempt to
%obtain user-specific advertisement information, but continues with
%generic advertisement if that attempt fails.  The prevalence of mobile
%services and their ``best-effort'' behavior make us believe that it
%would be beneficial if these services were designed to allow users to
%select the level of support they wish to obtain, instead of relying
%merely on connectivity for that purpose.

 
%The last column of the table shows the ratio of non-essential calls 
%made from a package out of the total number of non-essential calls, averaged for all applications that use the corresponding package, e.g., 403 in the case of Google Services. 
%Interestingly, the highest fraction of non-essential calls made by applications falls within this package. 
%There could be two reasons for this finding: first, applications commonly register for various Google services  services without eventually using
%them.


%Dead code comes from libraries. If 
%it is just not used by a specific application, but might be used by another one, so it is good to analaze it in any case


\conclusion{To answer RQ4, we conclude that non-essential communication is common in real-life applications. 
Such communication is not exclusive to the by A\&A packages, and not all communication stemming from these packages is non-essential.}
% and   packaged performed with various mobile services that are designed to be ``best-effort only'', i.e., communication failures do not prevent 
%successful application execution. Designing mobile services that allow the user to select the preferred level of support instead of relying merely on connectivity would be beneficial.}


